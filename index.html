<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ONE 1 | PRO</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <style>
        :root { --p: #6c5ce7; --bg: #ffffff; --gray: #f1f3f5; --text: #2d3436; --shadow: 0 4px 12px rgba(0,0,0,0.08); }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; font-family: 'Segoe UI', Tahoma, sans-serif; }
        body { background: var(--bg); color: var(--text); margin: 0; padding-bottom: 80px; overflow-x: hidden; display: none; }
        header { padding: 12px 20px; display: flex; align-items: center; justify-content: space-between; background: #fff; position: sticky; top: 0; z-index: 1000; box-shadow: 0 2px 10px rgba(0,0,0,0.03); }
        .logo { font-size: 22px; font-weight: 900; color: var(--p); letter-spacing: -1px; }
        .search-area { flex: 1; margin: 0 15px; }
        .search-area input { width: 100%; border: none; background: var(--gray); padding: 10px 15px; border-radius: 12px; font-size: 14px; outline: none; }
        .page { display: none; padding: 20px; animation: slideUp 0.4s ease; }
        .page.active { display: block; }
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.5); display: none; align-items: flex-end; z-index: 3000; }
        .modal-content { background: #fff; width: 100%; padding: 30px 25px; border-radius: 25px 25px 0 0; transform: translateY(100%); transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        .modal-content.open { transform: translateY(0); }
        .modal-input { width: 100%; padding: 15px; border: 2px solid var(--gray); border-radius: 15px; margin: 20px 0; font-size: 16px; outline: none; }
        .modal-btn { background: var(--p); color: #fff; width: 100%; padding: 16px; border: none; border-radius: 15px; font-weight: bold; cursor: pointer; }
        .support-card { background: #fff; border: 1px solid #eee; border-radius: 20px; padding: 25px; text-align: center; margin-top: 30px; }
        .support-icons { display: flex; justify-content: center; gap: 20px; margin-top: 15px; }
        .s-icon { width: 55px; height: 55px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px; text-decoration: none; box-shadow: var(--shadow); color: #fff; }
        .s-icon.wa { background: #25D366; }
        .s-icon.ml { background: var(--p); }
        .profile-card { text-align: center; margin-bottom: 30px; }
        .avatar-wrap { position: relative; width: 110px; height: 110px; margin: 0 auto 15px; }
        .avatar-wrap img { width: 100%; height: 100%; border-radius: 50%; border: 4px solid #fff; box-shadow: 0 5px 20px rgba(0,0,0,0.1); }
        .v-badge { color: var(--p); font-size: 18px; margin-right: 5px; }
        .bottom-nav { position: fixed; bottom: 0; width: 100%; background: #fff; display: flex; justify-content: space-around; padding: 15px 0; border-top: 1px solid #f0f0f0; z-index: 2000; }
        .nav-item { color: #bdc3c7; font-size: 22px; cursor: pointer; transition: 0.3s; }
        .nav-item.active { color: var(--p); transform: translateY(-3px); }
        .plus-fab { background: var(--p); width: 55px; height: 55px; border-radius: 20px; color: #fff !important; display: flex; align-items: center; justify-content: center; margin-top: -40px; box-shadow: 0 10px 25px rgba(108, 92, 231, 0.4); }
    </style>
</head>
<body>

    <header>
        <div class="logo">ONE 1</div>
        <div class="search-area"><input type="text" placeholder="ابحث عن منتجات..."></div>
        <div id="topInitial" style="width:35px; height:35px; background:var(--p); color:#fff; display:flex; align-items:center; justify-content:center; border-radius:10px; font-weight:bold;">U</div>
    </header>

    <div id="home" class="page active">
        <div style="text-align: center; margin-top: 100px; color: #ccc;">
            <i class="fa-solid fa-bag-shopping" style="font-size: 60px; margin-bottom: 20px; opacity: 0.5;"></i>
            <p>لا توجد إعلانات نشطة حالياً</p>
        </div>
    </div>

    <div id="favs" class="page">
        <h3>المفضلة</h3>
        <p style="color:#aaa">قائمتك فارغة.</p>
    </div>

    <div id="chat" class="page">
        <div style="height: 150px; display: flex; align-items: center; justify-content: center; color: #ccc;">لا توجد دردشات</div>
        <div class="support-card">
            <div style="font-weight: bold; margin-bottom: 10px;">مركز الدعم الفني</div>
            <div class="support-icons">
                <a href="https://wa.me/972592738901" class="s-icon wa"><i class="fa-brands fa-whatsapp"></i></a>
                <a href="mailto:sw803812@gmail.com" class="s-icon ml"><i class="fa-regular fa-envelope"></i></a>
            </div>
        </div>
    </div>

    <div id="profile" class="page">
        <div class="profile-card">
            <div class="avatar-wrap"><img src="https://ui-avatars.com/api/?background=6c5ce7&color=fff&name=User" id="uImg"></div>
            <h2 id="uName">تحميل...</h2>
            <p id="uEmail" style="color: #95a5a6; font-size: 14px;"></p>
        </div>
        <div style="display: grid; gap: 15px;">
            <div onclick="openEditModal()" style="background:var(--gray); padding:18px; border-radius:18px; display:flex; align-items:center; cursor:pointer;">
                <i class="fa-regular fa-user" style="margin-left:15px; color:var(--p); font-size:20px;"></i>
                <span style="font-weight:600">تغيير اسم العرض</span>
            </div>
            <div id="btnLogout" style="background:#fff5f5; padding:18px; border-radius:18px; display:flex; align-items:center; cursor:pointer; color:#eb4d4b;">
                <i class="fa-solid fa-power-off" style="margin-left:15px;"></i>
                <span style="font-weight:600">خروج من الحساب</span>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="editModal" onclick="closeEditModal(event)">
        <div class="modal-content" id="mCont">
            <h3>تعديل الاسم</h3>
            <input type="text" id="newNameInput" class="modal-input" placeholder="أدخل اسمك الجديد">
            <button class="modal-btn" id="saveBtn" onclick="saveName()">حفظ التغييرات</button>
        </div>
    </div>

    <nav class="bottom-nav">
        <div class="nav-item active" onclick="tab('home', this)"><i class="fa-solid fa-house"></i></div>
        <div class="nav-item" onclick="tab('favs', this)"><i class="fa-regular fa-heart"></i></div>
        <div class="nav-item plus-fab"><i class="fa-solid fa-plus"></i></div>
        <div class="nav-item" onclick="tab('chat', this)"><i class="fa-regular fa-comment"></i></div>
        <div class="nav-item" onclick="tab('profile', this)"><i class="fa-regular fa-user"></i></div>
    </nav>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const config = { 
            apiKey: "AIzaSyDj1jWQZHnELXe_eFkfGpi3F3_jPGhPm7I", 
            authDomain: "one1-95c0e.firebaseapp.com", 
            projectId: "one1-95c0e", 
            appId: "1:1090900617422:web:f6e9c11bb7a090c39ec89f" 
        };

        const app = initializeApp(config);
        const auth = getAuth(app);
        const db = getFirestore(app);

        onAuthStateChanged(auth, (user) => {
            if (user) {
                document.body.style.display = "block";
                updateUI(user);
            } else {
                window.location.href = "auth.html";
            }
        });

        async function updateUI(user) {
            document.getElementById('uEmail').innerText = user.email;
            const userRef = doc(db, "users", user.uid);
            try {
                const res = await getDoc(userRef);
                if (!res.exists()) {
                    await setDoc(userRef, {
                        name: "مستخدم جديد",
                        email: user.email,
                        isVerified: false
                    });
                }
                const data = res.data() || {};
                const name = data.name || "مستخدم جديد";
                const verified = data.isVerified ? ' <i class="fa-solid fa-patch-check v-badge"></i>' : '';
                document.getElementById('uName').innerHTML = name + verified;
                document.getElementById('topInitial').innerText = name.charAt(0).toUpperCase();
            } catch (e) {
                console.error(e);
            }
        }

        window.saveName = async () => {
            const btn = document.getElementById('saveBtn');
            const name = document.getElementById('newNameInput').value.trim();
            if (!name) return;
            btn.innerText = "جاري الحفظ...";
            btn.disabled = true;
            try {
                await setDoc(doc(db, "users", auth.currentUser.uid), { name: name }, { merge: true });
                await updateUI(auth.currentUser);
                closeEditModal({target: {id: 'editModal'}});
            } catch (e) {
                alert("خطأ في الحفظ");
            } finally {
                btn.innerText = "حفظ التغييرات";
                btn.disabled = false;
            }
        };

        window.tab = (id, el) => {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            el.classList.add('active');
        };

        window.openEditModal = () => {
            document.getElementById('editModal').style.display = 'flex';
            setTimeout(() => document.getElementById('mCont').classList.add('open'), 10);
        };

        window.closeEditModal = (e) => {
            if (e.target.id === 'editModal') {
                document.getElementById('mCont').classList.remove('open');
                setTimeout(() => document.getElementById('editModal').style.display = 'none', 300);
            }
        };

        document.getElementById('btnLogout').onclick = () => signOut(auth);
    </script>
</body>
</html>
